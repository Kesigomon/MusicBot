pipeline {
  agent any
  stages {
    stage('Build Image') {
        steps {
            withCredentials([string(credentialsId: 'ENDPOINT', variable: 'ENDPOINT')]) {
                sh '''docker buildx build --push --platform linux/arm64,linux/amd64 -t \\
                    ${ENDPOINT}:$(echo $GIT_BRANCH | sed -e \'s/origin\\///g\' -e \'s|/|_|g\') .'''
            }
            
        }
    }
  }
}